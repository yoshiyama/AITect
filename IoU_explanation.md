# IoU（Intersection over Union）の分かりやすい説明

## 1. IoUとは何か？

IoU（アイオーユー）は、物体検出の「答え合わせ」で使う重要な指標です。

```
IoU = 重なっている部分の面積 ÷ 全体の面積
```

### 具体例で理解する

```
【完全一致】IoU = 1.0
┌─────┐
│正解=│  正解と予測が
│予測 │  ピッタリ重なる
└─────┘

【良い検出】IoU = 0.8
┌─────┐
│ ┌───┼─┐
│ │重な│ │ 80%重なっている
│ │り部│ │
└─┼───┘ │
  └─────┘

【ギリギリ合格】IoU = 0.5
┌─────┐
│   ┌─┼───┐
│   │ │   │ 半分重なっている
└───┼─┘   │
    └─────┘

【検出失敗】IoU = 0.2
┌─────┐
│     │   ┌─────┐
│     │   │予測  │ ほとんど重ならない
└─────┘   └─────┘
```

## 2. IoUの判定基準

物体検出では、一般的に：
- **IoU ≥ 0.5**：正しい検出（True Positive）
- **IoU < 0.5**：間違った検出（False Positive）

つまり、「半分以上重なっていれば正解」という基準です。

## 3. 評価結果のIoU統計の読み方

### 実際の評価結果の例
```
IoU統計 (TP予測のみ):
  平均IoU: 0.7234
  標準偏差: 0.1523
  最小IoU: 0.5012
  最大IoU: 0.9856
  中央値IoU: 0.7456
  TP予測数: 35
```

### 各数値の意味

1. **平均IoU: 0.7234**
   - 正しく検出できたもの（TP）の平均的な重なり具合
   - 0.7以上なら「かなり正確に位置を当てている」

2. **標準偏差: 0.1523**
   - IoUのばらつき具合
   - 0.15程度なら「安定した検出」
   - 0.2以上だと「検出精度が不安定」

3. **最小IoU: 0.5012**
   - 一番悪い検出でも0.5を超えている
   - つまり「すべてのTPが基準をクリア」

4. **最大IoU: 0.9856**
   - ほぼ完璧な検出もある
   - 1.0に近いほど優秀

5. **中央値IoU: 0.7456**
   - 半数以上の検出が0.74以上の精度
   - 平均値と近ければ、外れ値が少ない

## 4. IoU結果から分かること

### 良いモデルの特徴
- 平均IoU > 0.7
- 標準偏差 < 0.15
- 最小IoU > 0.6

### 問題のあるモデルの例

#### パターン1：位置ずれ
```
平均IoU: 0.55
標準偏差: 0.08（安定）
→ 一貫して少しずつ位置がずれている
```

#### パターン2：不安定
```
平均IoU: 0.65
標準偏差: 0.25（大きい）
→ 当たったり外れたりが激しい
```

## 5. IoUと他の指標の関係

```
高Precision + 低IoU = 「検出はできるが、位置が不正確」
高Recall + 低IoU = 「たくさん見つけるが、精度が低い」
高F1 + 高IoU = 「理想的！検出も位置も正確」
```

## 6. 改善のヒント

| IoUの問題 | 原因 | 対策 |
|----------|------|------|
| 平均が低い（<0.6） | ボックス予測が不正確 | 回帰損失の重みを増やす |
| ばらつきが大きい | 学習が不安定 | 学習率を下げる、データ増やす |
| 最小値が0.5未満 | 閾値設定の問題 | 信頼度閾値を上げる |

## まとめ

IoUは「予測ボックスがどれだけ正解に近いか」を表す指標です。
- 0.5以上で合格
- 0.7以上で優秀
- 平均値だけでなく、ばらつきも重要

評価結果を見るときは、Precision/Recallと一緒にIoU統計も確認することで、モデルの本当の実力が分かります。